<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>(ಠ⌣ಠ)</title>
        <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">GLaDOS Logs</a>
            </div>
            <form class="navbar-form navbar-left">
                <div class="btn-group" id="levelToggle" data-toggle="buttons">
                    <label class="btn btn-info active" data-level="help"><input type="checkbox" checked><i class="fa fa-check"></i> Help</label>
                    <label class="btn btn-info active" data-level="verbose"><input type="checkbox" checked><i class="fa fa-check"></i> Verbose</label>
                    <label class="btn btn-warning active" data-level="warn"><input type="checkbox" checked><i class="fa fa-check"></i> Warning</label>
                    <label class="btn btn-danger active" data-level="error"><input type="checkbox" checked><i class="fa fa-check"></i> Error</label>
                    <label class="btn btn-success active" data-level="info"><input type="checkbox" checked><i class="fa fa-check"></i> Info</label>
                    <label class="btn btn-primary active" data-level="debug"><input type="checkbox" checked><i class="fa fa-check"></i> Debug</label>
                    <label class="btn btn-default active" data-level="data"><input type="checkbox" checked><i class="fa fa-check"></i> Data</label>
                </div>
            </form>
        </div>
        <table class="table table-striped" id="messages"></table>
        <script type="text/javascript" src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script type="text/javascript">
        $(function() {
            var socket = io.connect('http://localhost');
            var $messages = $('#messages');
            socket.on('logging', function(level, message, meta, date) {
                date = new Date(date);
                var $tr = $('<tr log-level="' + level + '"></tr>');

                $tr.append( getDate(date) );
                $tr.append( getLevel(level) );
                $tr.append( getMessage(message, meta) );

                $messages.append($tr);
            });

            $(document).on('click', '.message.openable .chevron', function(e) {
                $(this).parent('.openable').toggleClass('open');
            });

            $('#levelToggle .btn').click(function(e) {
                var isActive = !$(this).hasClass('active');
                var level = $(this).attr('data-level');
                $(this).find('i').attr('class', isActive ? 'fa fa-check' : 'fa fa-times');
                if(isActive) {
                    $('#messages .level[data-level="' + level + '"]').parent('tr').show();
                } else {
                    $('#messages .level[data-level="' + level + '"]').parent('tr').hide();
                }
            });
            
            function getMessage(message, meta) {
                var $td = $('<td class="message"></td>');
                $td.append('<div class="raw">' + message + '</div>');
                if(Object.keys(meta).length > 0) {
                    $td.addClass('openable');
                    $td.append('<i class="chevron fa fa-chevron-down"></i>');
                    $td.append('<pre class="meta">' + JSON.stringify(meta, null, 4) + '</pre>');
                }
                return $td;
            }
            function getLevel(level) {
                var $td = $('<td class="level"></td>');
                switch(level) {
                    case 'help': {
                        $td.attr('data-level', 'help');
                        $td.append('<span class="label label-info">Help/Verbose</span>');
                        break;
                    }
                    case 'verbose': {
                        $td.attr('data-level', 'verbose');
                        $td.append('<span class="label label-info">Verbose</span>');
                        break;
                    }
                    case 'warn': {
                        $td.attr('data-level', 'warn');
                        $td.append('<span class="label label-warning">Warning</span>');
                        break;
                    }
                    case 'error': {
                        $td.attr('data-level', 'error');
                        $td.append('<span class="label label-danger">Error</span>');
                        break;
                    }
                    case 'info': {
                        $td.attr('data-level', 'info');
                        $td.append('<span class="label label-success">Info</span>');
                        break;
                    }
                    case 'debug': {
                        $td.attr('data-level', 'debug');
                        $td.append('<span class="label label-primary">Debug</span>');
                        break;
                    }
                    default: {
                        $td.attr('data-level', 'data');
                        $td.append('<span class="label label-default">' + (level.charAt(0).toUpperCase() + level.slice(1)) + '</span>');
                        break;
                    }
                }
                return $td;
            }
            function getDate(date) {
                var $td = $('<td class="date"></td>');
                $td.append('<span class="label label-primary">' + pad(date.getDate(),2) + '.' + pad(date.getMonth()+1, 2) + '.' + pad(date.getFullYear(), 4) + '-' + pad(date.getHours(), 2) + ':' + pad(date.getMinutes(), 2) + ':' + pad(date.getSeconds(), 2) + ':' + pad(date.getMilliseconds(), 3) + '</span>');
                return $td;
            }
            function pad(num, size) {
                num = num.toString();
                while (num.length < size) num = "0" + num;
                return num;
            }
        });
        </script>
    </body>
</html>
